{"version":3,"sources":["Jogador.js"],"names":["Teclado","require","cc","Class","extends","Component","properties","tiro","Prefab","vidaMaxima","Float","_vidaAtual","_direcao","Vec2","_movimentacao","_controleAnimacao","_canvas","Canvas","_camera","Node","_posicaoArma","_audioTiro","AudioSource","onLoad","getComponent","find","on","atirar","mudarDirecaoDaAnimcao","node","sofrerDano","children","update","deltaTime","setDirecao","andarPraFrente","ZERO","estaPressionada","KEY","a","x","d","s","y","w","evento","detail","dano","eventoPerdeVida","Event","EventCustom","setUserData","vidaAtual","dispatchEvent","jogoAcabou","event","direcao","calcularDirecaoMouse","estado","mag","mudaAnimacao","posicaoMouse","getLocation","convertToNodeSpaceAR","posicaoJogadora","position","sub","disparo","instantiate","iniciliza","parent","add","play"],"mappings":"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","file":"Jogador.js","sourceRoot":"..\\..\\..\\..\\assets\\Scripts","sourcesContent":["let Teclado = require(\"Teclado\");\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        tiro : cc.Prefab,\n        vidaMaxima : cc.Float,\n        \n        _vidaAtual : cc.Float,\n        _direcao : cc.Vec2,\n        _movimentacao : cc.Component,\n        _controleAnimacao : cc.Component,\n        _canvas : cc.Canvas,\n        _camera : cc.Node,\n        _posicaoArma : cc.Node,\n        _audioTiro : cc.AudioSource,\n\n    },\n\n\n    onLoad: function () {\n       \n        this._movimentacao = this.getComponent(\"Movimentacao\");\n        this._controleAnimacao = this.getComponent(\"ControleDeAnimacao\");\n        this._audioTiro = this.getComponent(cc.AudioSource);\n        this._canvas = cc.find(\"Canvas\");\n        this._canvas.on(\"mousedown\", this.atirar, this);\n        this._canvas.on(\"mousemove\", this.mudarDirecaoDaAnimcao, this);\n        this._camera = cc.find(\"Camera\");\n        this.node.on(\"SofreDano\", this.sofrerDano, this);\n        this._vidaAtual = this.vidaMaxima;\n        this._posicaoArma = this.node.children[0];\n    },\n\n    update: function (deltaTime) {\n        this._movimentacao.setDirecao(this._direcao);\n        this._movimentacao.andarPraFrente();\n\n        this._direcao = cc.Vec2.ZERO;\n        \n        if(Teclado.estaPressionada(cc.KEY.a)){\n            this._direcao.x -=1;\n        }\n        if(Teclado.estaPressionada(cc.KEY.d)){\n            this._direcao.x +=1;\n        }\n        \n         if(Teclado.estaPressionada(cc.KEY.s)){\n            this._direcao.y -=1;\n        }\n        if(Teclado.estaPressionada(cc.KEY.w)){\n            this._direcao.y +=1;\n        }\n    },\n\n    sofrerDano: function(evento){\n        this._vidaAtual -= evento.detail.dano;\n        let eventoPerdeVida = new cc.Event.EventCustom(\"JogadoraPerdeuVida\", true);\n        eventoPerdeVida.setUserData({vidaAtual : this._vidaAtual ,  vidaMaxima : this.vidaMaxima});\n        this.node.dispatchEvent(eventoPerdeVida);\n        if(this._vidaAtual <0){\n            let jogoAcabou = new cc.Event.EventCustom(\"JogoAcabou\", true);\n            this.node.dispatchEvent(jogoAcabou);\n        }\n    },\n\n    mudarDirecaoDaAnimcao : function(event){\n        let direcao = this.calcularDirecaoMouse(event);\n        let estado;\n        if(this._direcao.mag() == 0){\n            estado = \"Parado\";\n        }else{\n            estado = \"Andar\";\n        }\n        this._controleAnimacao.mudaAnimacao(direcao, estado);\n    },\n\n    calcularDirecaoMouse : function(event){\n        let posicaoMouse = event.getLocation();\n        posicaoMouse = new cc.Vec2(posicaoMouse.x, posicaoMouse.y);\n        posicaoMouse = this._canvas.convertToNodeSpaceAR(posicaoMouse);\n        let posicaoJogadora = this._camera.convertToNodeSpaceAR(this.node.position);\n\n        let direcao = posicaoMouse.sub(posicaoJogadora);\n        return direcao;\n    },\n\n    atirar : function(event){\n        let direcao = this.calcularDirecaoMouse(event);\n        let disparo = cc.instantiate(this.tiro);  \n        disparo.getComponent(\"Tiro\").iniciliza(this.node.parent,\n                                               this._posicaoArma.position.add(this.node.position),\n                                               direcao);\n\n        this._audioTiro.play();\n    },\n    \n    \n    \n    \n    \n    \n    \n\n});\n"]}